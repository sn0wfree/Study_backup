---
title: "Assignment"
author: "sn0wfree"
date: "12/16/2016"
output:
  html_notebook:
    toc: yes
  html_document:
    toc: yes
  pdf_document:
    toc: yes
---


## Import Data
```{r import date}
crowdfunding<-read.csv( "forqrm.csv" ,header=1)
crowdfunding_region<-read.csv( "forqrm.csv" ,header=1)
head(crowdfunding)
library(lmtest)

rownames(crowdfunding)<-crowdfunding$State
se<-crowdfunding[c("GiniCoeff","pAdDeg","successful_rate")]
se
#cor
```

## Find Topics
### 1.Geography information

1. Geography information:found the significally different by state/by region
  + Amount
  + successfull rate
  within graphy/plot
  
### 2.Factors analysis:
  
2. factors:studying the relationship between Successful Rate and other factors:
  + Higher Eduction:pAdDeg;
  + Ginicoeff
  # average_pledged_amount_of_Grand.Total#
```{r pie}
pie(table(crowdfunding_region$Region))

```


### 3.Total regression
```{r regression}

successful_rate2GiniCoeff<-lm(crowdfunding$successful_rate~crowdfunding$GiniCoeff)#significant:0.00398
summary(successful_rate2GiniCoeff)

successful_rate2NPov000s<-lm(crowdfunding$successful_rate~crowdfunding$NPov000s)#0.231
summary(successful_rate2NPov000s)

summary(lm(crowdfunding$successful_rate~crowdfunding$pHigh))#bad:0.2320 
summary(lm(crowdfunding$successful_rate~crowdfunding$pBatDeg))#low:0.05511

successful_rate2pAdDeg<-lm(crowdfunding$successful_rate~crowdfunding$pAdDeg)#significant:0.00501
summary(successful_rate2pAdDeg)

#supplement regression
summary(lm(crowdfunding$GiniCoeff~crowdfunding$pAdDeg))#significant:0.0353


summary(lm(crowdfunding$count_of_Grand.Total~crowdfunding$Pop2010))#significant:0.0353

#summary(lm(successful_rate2PovRate1$residuals~crowdfunding$pAdDeg))#0.0003881
#summary(lm(successful_rate2PovRate1$residuals~crowdfunding$GiniCoeff))#0.0264

summary(lm(successful_rate2GiniCoeff$residuals~crowdfunding$pAdDeg))#residuals ~ ADdeg:0.0368
#summary(lm(successful_rate2GiniCoeff$residuals~crowdfunding$PovRate1))#residuals ~ PovRate1:0.771

#summary(lm(successful_rate2pAdDeg$residuals~crowdfunding$PovRate1))#0.004505
summary(lm(successful_rate2pAdDeg$residuals~crowdfunding$GiniCoeff))#0.0295


#summary(lm(log(crowdfunding$average_pledged_amount_of_Grand.Total)~crowdfunding$GiniCoeff))#0.02357


```

## Geography information



### Geography information-preprocess:kmean
```{r kmeans}
hc<-hclust(dist(crowdfunding),method = "ward.D", members = NULL)
plclust(hc)
rect.hclust(hc,k=2)


heatmap(as.matrix(dist(crowdfunding,method= 'euclidean')),labRow = F, labCol = F)
result<-cutree(hc,k=2)
result.category<-as.data.frame(result)
colnames(result.category)<-c("MDS_Category")
result.category
pie(result)
barplot(result,col =result )
#table(result)
#summary(result)
plot(result,type = "p",col=result,xlab="State",xaxt="n",ylab="MDS_Category")


library(ggplot2)
mds2 <- -cmdscale(dist(crowdfunding))
plot(mds2, type="n", axes=FALSE, ann=FALSE)
text(mds2, labels=rownames(mds2), xpd = NA)

mds<-cmdscale(dist(crowdfunding),k=2,eig=T)
x = mds$points[,1]
y = mds$points[,2]
p=ggplot(data.frame(x,y),aes(x,y))
p+geom_point(size=5 , alpha=0.8 , aes(colour=factor(result) ))


  
```



```{r regroup}
#regroup-------------------------------
#crowdfunding.backup<-crowdfunding

result.category["State"]<-row.names(result.category)

#crowdfunding<-crowdfunding[c("State","successful_rate","Region","count_of_Grand.Total","GiniCoeff","pAdDeg","pHigh","pBatDeg","Pop2010")]
#crowdfunding$Pop2010<-log(crowdfunding$Pop2010)
#crowdfunding$count_of_Grand.Total<-log(crowdfunding$count_of_Grand.Total)
crowdfunding<-merge(crowdfunding,result.category,all.x=TRUE)
#row.names(crowdfunding)<-crowdfunding$State

#GiniCoeff-------
par(mfrow=c(1,2))
plot(crowdfunding$successful_rate[crowdfunding$MDS_Category==1]~crowdfunding$GiniCoeff[crowdfunding$MDS_Category==1])
points(lowess(crowdfunding$successful_rate[crowdfunding$MDS_Category==1]~crowdfunding$GiniCoeff[crowdfunding$MDS_Category==1]),type="l",col="red")

plot(crowdfunding$successful_rate[crowdfunding$MDS_Category==2]~crowdfunding$GiniCoeff[crowdfunding$MDS_Category==2])
points(lowess(crowdfunding$successful_rate[crowdfunding$MDS_Category==2]~crowdfunding$GiniCoeff[crowdfunding$MDS_Category==2]),type="l",col="red")

summary(lm(crowdfunding$successful_rate[crowdfunding$MDS_Category==1]~crowdfunding$GiniCoeff[crowdfunding$MDS_Category==1]))
summary(lm(crowdfunding$successful_rate[crowdfunding$MDS_Category==2]~crowdfunding$GiniCoeff[crowdfunding$MDS_Category==2]))

#pAdDeg-------
plot(crowdfunding$successful_rate[crowdfunding$MDS_Category==1]~crowdfunding$pAdDeg[crowdfunding$MDS_Category==1])
points(lowess(crowdfunding$successful_rate[crowdfunding$MDS_Category==1]~crowdfunding$pAdDeg[crowdfunding$MDS_Category==1]),type="l",col="red")
plot(crowdfunding$successful_rate[crowdfunding$MDS_Category==2]~crowdfunding$pAdDeg[crowdfunding$MDS_Category==2])
points(lowess(crowdfunding$successful_rate[crowdfunding$MDS_Category==2]~crowdfunding$pAdDeg[crowdfunding$MDS_Category==2]),type="l",col="red")

summary(lm(crowdfunding$successful_rate[crowdfunding$MDS_Category==1]~crowdfunding$pAdDeg[crowdfunding$MDS_Category==1]))
summary(lm(crowdfunding$successful_rate[crowdfunding$MDS_Category==2]~crowdfunding$pAdDeg[crowdfunding$MDS_Category==2]))

```





### Geography Information-simpleplot
```{r Geography Information-simpleplot}
par(mfrow=c(1,2) )

#count_of_Grand.Total
plot(crowdfunding$count_of_Grand.Total,col=crowdfunding$Region, main="Count of Projects Plot",ylab="Count of Projects",xaxt="n",xlab="State")
#axis(side=1,at=c(1,2,3,4,5,6,7,8),labels=c(crowdfunding$State))
legend("topright",legend = levels(crowdfunding$Region),cex = 0.8, pch = 1,col=1:4)



#successful_rate
plot(crowdfunding$successful_rate,col=crowdfunding$Region, main="Successful Rate Plot",ylab="Successful Rate",xaxt="n",xlab="State")
#axis(side=1,at=c(1,2,3,4,5,6,7,8),labels=c(crowdfunding$State))
legend("topleft",legend = levels(crowdfunding$Region),cex = 0.8, pch = 1,col=1:4)
```

### Geography information-boxplot
```{r Geography information-boxplot}
par(mfrow=c(1,3))
#Boxplot for successful_rate and count_of_Grand.Total
#count_of_Grand.Total
boxplot(crowdfunding$count_of_Grand.Total[crowdfunding$Region=="Midwest"],
        crowdfunding$count_of_Grand.Total[crowdfunding$Region=="Northeast"],
        crowdfunding$count_of_Grand.Total[crowdfunding$Region=="South"],
        crowdfunding$count_of_Grand.Total[crowdfunding$Region=="West"],
        names=levels(crowdfunding$Region),main="Count of Projects BoxPlot by Region",varwidth=TRUE)

require(moments)
skewness(crowdfunding_region$count_of_Grand.Total[crowdfunding_region$Region=="Midwest"])
skewness(crowdfunding_region$count_of_Grand.Total[crowdfunding_region$Region=="Northeast"])
skewness(crowdfunding_region$count_of_Grand.Total[crowdfunding_region$Region=="South"])
skewness(crowdfunding_region$count_of_Grand.Total[crowdfunding_region$Region=="West"])

kurtosis(crowdfunding_region$count_of_Grand.Total[crowdfunding_region$Region=="Midwest"])
kurtosis(crowdfunding_region$count_of_Grand.Total[crowdfunding_region$Region=="Northeast"])
kurtosis(crowdfunding_region$count_of_Grand.Total[crowdfunding_region$Region=="South"])
kurtosis(crowdfunding_region$count_of_Grand.Total[crowdfunding_region$Region=="West"])


boxplot(log(crowdfunding_region$count_of_Grand.Total[crowdfunding_region$Region=="Midwest"]),
        log(crowdfunding_region$count_of_Grand.Total[crowdfunding_region$Region=="Northeast"]),
        log(crowdfunding_region$count_of_Grand.Total[crowdfunding_region$Region=="South"]),
        log(crowdfunding_region$count_of_Grand.Total[crowdfunding_region$Region=="West"]),
        names=levels(crowdfunding$Region),main="Log Count of Projects BoxPlot by Region")



#successful_rate
boxplot(crowdfunding$successful_rate[crowdfunding$Region=="Midwest"],
        crowdfunding$successful_rate[crowdfunding$Region=="Northeast"],
        crowdfunding$successful_rate[crowdfunding$Region=="South"],
        crowdfunding$successful_rate[crowdfunding$Region=="West"],
        names=levels(crowdfunding$Region),main="Successful Rate BoxPlot by Region")

skewness(crowdfunding_region$successful_rate[crowdfunding_region$Region=="Midwest"])
skewness(crowdfunding_region$successful_rate[crowdfunding_region$Region=="Northeast"])
skewness(crowdfunding_region$successful_rate[crowdfunding_region$Region=="South"])
skewness(crowdfunding_region$successful_rate[crowdfunding_region$Region=="West"])


kurtosis(crowdfunding_region$successful_rate[crowdfunding_region$Region=="Midwest"])
kurtosis(crowdfunding_region$successful_rate[crowdfunding_region$Region=="Northeast"])
kurtosis(crowdfunding_region$successful_rate[crowdfunding_region$Region=="South"])
kurtosis(crowdfunding_region$successful_rate[crowdfunding_region$Region=="West"])


par(mfrow=c(2,4))
#count_of_Grand.Total
qqnorm(crowdfunding$count_of_Grand.Total[crowdfunding$Region=="Midwest"],xlab="Midwest",xaxt="n",col="black",main="Count of Projects-Norm Q-Q Plot")
qqline(crowdfunding$count_of_Grand.Total[crowdfunding$Region=="Midwest"])

qqnorm(crowdfunding$count_of_Grand.Total[crowdfunding$Region=="Northeast"],xlab="Northeast",xaxt="n",col="red",main="Count of Projectse-Norm Q-Q Plot")
qqline(crowdfunding$count_of_Grand.Total[crowdfunding$Region=="Northeast"])

qqnorm(crowdfunding$count_of_Grand.Total[crowdfunding$Region=="South"],xlab="South",col="green",xaxt="n",main="Count of Projects-Norm Q-Q Plot")
qqline(crowdfunding$count_of_Grand.Total[crowdfunding$Region=="South"])

qqnorm(crowdfunding$count_of_Grand.Total[crowdfunding$Region=="West"],xlab="West",col="blue",xaxt="n",main="Count of Projects-Norm Q-Q Plot")
qqline(crowdfunding$count_of_Grand.Total[crowdfunding$Region=="West"])



#successful_rate
qqnorm(crowdfunding$successful_rate[crowdfunding$Region=="Midwest"],xlab="Midwest",col="black",xaxt="n",main="Successful Rate-Norm Q-Q Plot")
qqline(crowdfunding$successful_rate[crowdfunding$Region=="Midwest"])

qqnorm(crowdfunding$successful_rate[crowdfunding$Region=="Northeast"],xlab="Northeast",col="red",xaxt="n",main="Successful Rate-Norm Q-Q Plot")
qqline(crowdfunding$successful_rate[crowdfunding$Region=="Northeast"])

qqnorm(crowdfunding$successful_rate[crowdfunding$Region=="South"],xlab="South",col="green",xaxt="n",main="Successful Rate-Norm Q-Q Plot")
qqline(crowdfunding$successful_rate[crowdfunding$Region=="South"])

qqnorm(crowdfunding$successful_rate[crowdfunding$Region=="West"],xlab="West",col="blue",xaxt="n",main="Successful Rate-Norm Q-Q Plot")
qqline(crowdfunding$successful_rate[crowdfunding$Region=="West"])

kurtosis(crowdfunding$successful_rate[crowdfunding$Region=="Midwest"])
kurtosis(crowdfunding$successful_rate[crowdfunding$Region=="Northeast"])      
kurtosis(crowdfunding$successful_rate[crowdfunding$Region=="South"])      
kurtosis(crowdfunding$successful_rate[crowdfunding$Region=="West"])      


```
```{r}
par(mfrow=c(1,3))
qqnorm(crowdfunding$successful_rate, main ="Successful rate:Q-Q norm",col="red")
qqline(crowdfunding$successful_rate)
qqnorm(crowdfunding$GiniCoeff, main ="GiniCoeff:Q-Q norm",col="blue")
qqline(crowdfunding$GiniCoeff)
qqnorm(crowdfunding$pAdDeg, main ="pAdDeg:Q-Q norm",col="green")
qqline(crowdfunding$pAdDeg)

cor.test(crowdfunding$successful_rate,crowdfunding$GiniCoeff)
cor.test(crowdfunding$successful_rate,crowdfunding$pAdDeg,method="spearman")

```




### Geography information:factors
```{r}
boxplot(crowdfunding$GiniCoeff[crowdfunding$Region=="Midwest"],crowdfunding$GiniCoeff[crowdfunding$Region=="Northeast"],crowdfunding$GiniCoeff[crowdfunding$Region=="South"],crowdfunding$GiniCoeff[crowdfunding$Region=="West"],names=levels(crowdfunding$Region),main="GiniCoeff BoxPlot by Region",varwidth=TRUE)

boxplot(crowdfunding$pAdDeg[crowdfunding$Region=="Midwest"],crowdfunding$pAdDeg[crowdfunding$Region=="Northeast"],crowdfunding$pAdDeg[crowdfunding$Region=="South"],crowdfunding$pAdDeg[crowdfunding$Region=="West"],names=levels(crowdfunding$Region),main="pAdDeg BoxPlot by Region",varwidth=TRUE)


summary(lm(crowdfunding$successful_rate[crowdfunding$Region=="Midwest"]~crowdfunding$GiniCoeff[crowdfunding$Region=="Midwest"]))
par(mfrow=c(1,4))
#GiniCoeff---------
plot(crowdfunding$successful_rate[crowdfunding$Region=="Midwest"]~crowdfunding$GiniCoeff[crowdfunding$Region=="Midwest"],xlab="GiniCoeff in Midwest",ylab="Successful rate in Midwest")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="Midwest"]~crowdfunding$GiniCoeff[crowdfunding$Region=="Midwest"]),col="red",type="l")
plot(crowdfunding$successful_rate[crowdfunding$Region=="West"]~crowdfunding$GiniCoeff[crowdfunding$Region=="West"],xlab="GiniCoeff in West",ylab="Successful rate in West")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="West"]~crowdfunding$GiniCoeff[crowdfunding$Region=="West"]),col="red",type="l")

plot(crowdfunding$successful_rate[crowdfunding$Region=="South"]~crowdfunding$GiniCoeff[crowdfunding$Region=="South"],xlab="GiniCoeff in South",ylab="Successful rate in South")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="South"]~crowdfunding$GiniCoeff[crowdfunding$Region=="South"]),col="red",type="l")

plot(crowdfunding$successful_rate[crowdfunding$Region=="Northeast"]~crowdfunding$GiniCoeff[crowdfunding$Region=="Northeast"],xlab="GiniCoeff in Northeast",ylab="Successful rate in Northeast")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="Northeast"]~crowdfunding$GiniCoeff[crowdfunding$Region=="Northeast"]),col="red",type="l")


#pAdDeg-----------
plot(crowdfunding$successful_rate[crowdfunding$Region=="Midwest"]~crowdfunding$pAdDeg[crowdfunding$Region=="Midwest"],xlab="pAdDeg in Midwest",ylab="Successful rate in Midwest")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="Midwest"]~crowdfunding$pAdDeg[crowdfunding$Region=="Midwest"]),col="red",type="l")
plot(crowdfunding$successful_rate[crowdfunding$Region=="West"]~crowdfunding$pAdDeg[crowdfunding$Region=="West"],xlab="pAdDeg in West",ylab="Successful rate in West")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="West"]~crowdfunding$pAdDeg[crowdfunding$Region=="West"]),col="red",type="l")

plot(crowdfunding$successful_rate[crowdfunding$Region=="South"]~crowdfunding$pAdDeg[crowdfunding$Region=="South"],xlab="pAdDeg in South",ylab="Successful rate in South")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="South"]~crowdfunding$pAdDeg[crowdfunding$Region=="South"]),col="red",type="l")

plot(crowdfunding$successful_rate[crowdfunding$Region=="Northeast"]~crowdfunding$pAdDeg[crowdfunding$Region=="Northeast"],xlab="pAdDeg in Northeast",ylab="Successful rate in Northeast")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="Northeast"]~crowdfunding$pAdDeg[crowdfunding$Region=="Northeast"]),col="red",type="l")

#pBatDeg-----------
plot(crowdfunding$successful_rate[crowdfunding$Region=="Midwest"]~crowdfunding$pBatDeg[crowdfunding$Region=="Midwest"],xlab="pBatDeg in Midwest",ylab="Successful rate in Midwest")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="Midwest"]~crowdfunding$pBatDeg[crowdfunding$Region=="Midwest"]),col="red",type="l")
plot(crowdfunding$successful_rate[crowdfunding$Region=="West"]~crowdfunding$pBatDeg[crowdfunding$Region=="West"],xlab="pBatDeg in West",ylab="Successful rate in West")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="West"]~crowdfunding$pBatDeg[crowdfunding$Region=="West"]),col="red",type="l")

plot(crowdfunding$successful_rate[crowdfunding$Region=="South"]~crowdfunding$pBatDeg[crowdfunding$Region=="South"],xlab="pBatDeg in South",ylab="Successful rate in South")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="South"]~crowdfunding$pBatDeg[crowdfunding$Region=="South"]),col="red",type="l")

plot(crowdfunding$successful_rate[crowdfunding$Region=="Northeast"]~crowdfunding$pBatDeg[crowdfunding$Region=="Northeast"],xlab="pBatDeg in Northeast",ylab="Successful rate in Northeast")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="Northeast"]~crowdfunding$pBatDeg[crowdfunding$Region=="Northeast"]),col="red",type="l")

#pHigh-----------
plot(crowdfunding$successful_rate[crowdfunding$Region=="Midwest"]~crowdfunding$pHigh[crowdfunding$Region=="Midwest"],xlab="pHigh in Midwest",ylab="Successful rate in Midwest")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="Midwest"]~crowdfunding$pHigh[crowdfunding$Region=="Midwest"]),col="red",type="l")
plot(crowdfunding$successful_rate[crowdfunding$Region=="West"]~crowdfunding$pHigh[crowdfunding$Region=="West"],xlab="pHigh in West",ylab="Successful rate in West")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="West"]~crowdfunding$pHigh[crowdfunding$Region=="West"]),col="red",type="l")

plot(crowdfunding$successful_rate[crowdfunding$Region=="South"]~crowdfunding$pHigh[crowdfunding$Region=="South"],xlab="pHigh in South",ylab="Successful rate in South")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="South"]~crowdfunding$pHigh[crowdfunding$Region=="South"]),col="red",type="l")

plot(crowdfunding$successful_rate[crowdfunding$Region=="Northeast"]~crowdfunding$pHigh[crowdfunding$Region=="Northeast"],xlab="pHigh in Northeast",ylab="Successful rate in Northeast")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="Northeast"]~crowdfunding$pHigh[crowdfunding$Region=="Northeast"]),col="red",type="l")

```

```{r}
par(mfrow=c(1,4))
#GiniCoeff---------
plot(crowdfunding$successful_rate[crowdfunding$Region=="Midwest"]~crowdfunding$GiniCoeff[crowdfunding$Region=="Midwest"],xlab="GiniCoeff in Midwest",ylab="Successful rate in Midwest")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="Midwest"]~crowdfunding$GiniCoeff[crowdfunding$Region=="Midwest"]),col="red",type="l")
plot(crowdfunding$successful_rate[crowdfunding$Region=="West"]~crowdfunding$GiniCoeff[crowdfunding$Region=="West"],xlab="GiniCoeff in West",ylab="Successful rate in West")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="West"]~crowdfunding$GiniCoeff[crowdfunding$Region=="West"]),col="red",type="l")

plot(crowdfunding$successful_rate[crowdfunding$Region=="South"]~crowdfunding$GiniCoeff[crowdfunding$Region=="South"],xlab="GiniCoeff in South",ylab="Successful rate in South")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="South"]~crowdfunding$GiniCoeff[crowdfunding$Region=="South"]),col="red",type="l")

plot(crowdfunding$successful_rate[crowdfunding$Region=="Northeast"]~crowdfunding$GiniCoeff[crowdfunding$Region=="Northeast"],xlab="GiniCoeff in Northeast",ylab="Successful rate in Northeast")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="Northeast"]~crowdfunding$GiniCoeff[crowdfunding$Region=="Northeast"]),col="red",type="l")


#pAdDeg-----------
plot(crowdfunding$successful_rate[crowdfunding$Region=="Midwest"]~crowdfunding$pAdDeg[crowdfunding$Region=="Midwest"],xlab="pAdDeg in Midwest",ylab="Successful rate in Midwest")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="Midwest"]~crowdfunding$pAdDeg[crowdfunding$Region=="Midwest"]),col="red",type="l")
plot(crowdfunding$successful_rate[crowdfunding$Region=="West"]~crowdfunding$pAdDeg[crowdfunding$Region=="West"],xlab="pAdDeg in West",ylab="Successful rate in West")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="West"]~crowdfunding$pAdDeg[crowdfunding$Region=="West"]),col="red",type="l")

plot(crowdfunding$successful_rate[crowdfunding$Region=="South"]~crowdfunding$pAdDeg[crowdfunding$Region=="South"],xlab="pAdDeg in South",ylab="Successful rate in South")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="South"]~crowdfunding$pAdDeg[crowdfunding$Region=="South"]),col="red",type="l")

plot(crowdfunding$successful_rate[crowdfunding$Region=="Northeast"]~crowdfunding$pAdDeg[crowdfunding$Region=="Northeast"],xlab="pAdDeg in Northeast",ylab="Successful rate in Northeast")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="Northeast"]~crowdfunding$pAdDeg[crowdfunding$Region=="Northeast"]),col="red",type="l")

#pBatDeg-----------
plot(crowdfunding$successful_rate[crowdfunding$Region=="Midwest"]~crowdfunding$pBatDeg[crowdfunding$Region=="Midwest"],xlab="pBatDeg in Midwest",ylab="Successful rate in Midwest")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="Midwest"]~crowdfunding$pBatDeg[crowdfunding$Region=="Midwest"]),col="red",type="l")
plot(crowdfunding$successful_rate[crowdfunding$Region=="West"]~crowdfunding$pBatDeg[crowdfunding$Region=="West"],xlab="pBatDeg in West",ylab="Successful rate in West")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="West"]~crowdfunding$pBatDeg[crowdfunding$Region=="West"]),col="red",type="l")

plot(crowdfunding$successful_rate[crowdfunding$Region=="South"]~crowdfunding$pBatDeg[crowdfunding$Region=="South"],xlab="pBatDeg in South",ylab="Successful rate in South")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="South"]~crowdfunding$pBatDeg[crowdfunding$Region=="South"]),col="red",type="l")

plot(crowdfunding$successful_rate[crowdfunding$Region=="Northeast"]~crowdfunding$pBatDeg[crowdfunding$Region=="Northeast"],xlab="pBatDeg in Northeast",ylab="Successful rate in Northeast")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="Northeast"]~crowdfunding$pBatDeg[crowdfunding$Region=="Northeast"]),col="red",type="l")

#pHigh-----------
plot(crowdfunding$successful_rate[crowdfunding$Region=="Midwest"]~crowdfunding$pHigh[crowdfunding$Region=="Midwest"],xlab="pHigh in Midwest",ylab="Successful rate in Midwest")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="Midwest"]~crowdfunding$pHigh[crowdfunding$Region=="Midwest"]),col="red",type="l")
plot(crowdfunding$successful_rate[crowdfunding$Region=="West"]~crowdfunding$pHigh[crowdfunding$Region=="West"],xlab="pHigh in West",ylab="Successful rate in West")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="West"]~crowdfunding$pHigh[crowdfunding$Region=="West"]),col="red",type="l")

plot(crowdfunding$successful_rate[crowdfunding$Region=="South"]~crowdfunding$pHigh[crowdfunding$Region=="South"],xlab="pHigh in South",ylab="Successful rate in South")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="South"]~crowdfunding$pHigh[crowdfunding$Region=="South"]),col="red",type="l")

plot(crowdfunding$successful_rate[crowdfunding$Region=="Northeast"]~crowdfunding$pHigh[crowdfunding$Region=="Northeast"],xlab="pHigh in Northeast",ylab="Successful rate in Northeast")
points(lowess(crowdfunding$successful_rate[crowdfunding$Region=="Northeast"]~crowdfunding$pHigh[crowdfunding$Region=="Northeast"]),col="red",type="l")


```

### Geography information-t.test
```{r Geography information-t.test}
#t.test(crowdfunding$successful_rate[crowdfunding$Region=="West"],crowdfunding$successful_rate[crowdfunding$Region=="Northeast"])
#t.test(crowdfunding$count_of_Grand.Total[crowdfunding$Region=="West"],crowdfunding$count_of_Grand.Total[crowdfunding$Region=="Northeast"])


#calcualte P Value in the t.test of Successful Rate by Region 

p=NULL
temp<-NULL
for (location1 in c(levels(crowdfunding$Region))){
  for (location2 in c(levels(crowdfunding$Region))){
    if (1){
      temp<-t.test(crowdfunding$successful_rate[crowdfunding$Region==location1],crowdfunding$successful_rate[crowdfunding$Region==location2])
      if(temp$p.value<=0.1){
        #print(c(location1,location2,temp$p.value))
      }
      p<-c(p,temp$p.value)}}}
SR.t.test.p.vlaue<-as.data.frame(matrix(p,4,4),row.names = c(levels(crowdfunding$Region)))
colnames(SR.t.test.p.vlaue)<-c(levels(crowdfunding$Region))
print("Successful Rate by Region")
SR.t.test.p.vlaue
#--------------------------------------------------------
#calcualte P Value in the t.test of Count of projects by Region 

p=NULL
temp<-NULL
for (location1 in c(levels(crowdfunding$Region))){
  for (location2 in c(levels(crowdfunding$Region))){
    if (1){
      temp<-t.test(log(crowdfunding$count_of_Grand.Total[crowdfunding$Region==location1]),log(crowdfunding$count_of_Grand.Total[crowdfunding$Region==location2]))
      if(temp$p.value<=0.1){
        #print(c(location1,location2,temp$p.value))
      }
      p<-c(p,temp$p.value)}}}
CP.t.test.p.vlaue<-as.data.frame(matrix(p,4,4),row.names = c(levels(crowdfunding$Region)))
colnames(CP.t.test.p.vlaue)<-c(levels(crowdfunding$Region))
print("Count of Projects by Region ")
CP.t.test.p.vlaue
#--------------------------------------------------------
#calcualte P Value in the t.test of Count of projects by kmeans 
"MDS-Category"

p=NULL

temp<-NULL
#for (location1 in 1:4){
#  for (location2 in 1:4){
#    if (1){
#      temp<-t.test(crowdfunding$successful_rate[crowdfunding$MDS_Category==location1],crowdfunding$successful_rate[crowdfunding$MDS_Category==location2])
#      if(temp$p.value<=0.1){
#        print(c(location1,location2,temp$p.value))
#      }
#      p<-c(p,temp$p.value)}}}
#MDSR.t.test.p.vlaue<-as.data.frame(matrix(p,4,4),row.names = c(1:4))
#colnames(MDSR.t.test.p.vlaue)<-c(1:4)
#print("Successful Rate by Region")
#MDSR.t.test.p.vlaue


```

### Geography information-t-bootstrap
```{r}
bootstrapfunctiontest<-function(target.sample,n){
  temp=0
  for(i in 1:n){
    temp[i]=mean(target.sample[sample(1:length(target.sample),replace = TRUE)])
  }
  return (temp)
}

#Successful rate
Northeast.SR.bootstrap=bootstrapfunctiontest(crowdfunding$successful_rate[crowdfunding$Region=="Northeast"],1000)
West.SR.bootstrap=bootstrapfunctiontest(crowdfunding$successful_rate[crowdfunding$Region=="West"],1000)
Midwest.SR.bootstrap=bootstrapfunctiontest(crowdfunding$successful_rate[crowdfunding$Region=="Midwest"],1000)
South.SR.bootstrap=bootstrapfunctiontest(crowdfunding$successful_rate[crowdfunding$Region=="South"],1000)
Northeast.West.SR.t<-t.test(Northeast.SR.bootstrap,West.SR.bootstrap)
Northeast.South.SR.t<-t.test(Northeast.SR.bootstrap,South.SR.bootstrap)
Northeast.Midwest.SR.t<-t.test(Northeast.SR.bootstrap,Midwest.SR.bootstrap)
West.Midwest.SR.t<-t.test(West.SR.bootstrap,Midwest.SR.bootstrap)
West.South.SR.t<-t.test(West.SR.bootstrap,South.SR.bootstrap)
Midwest.South.SR.t<-t.test(Midwest.SR.bootstrap,South.SR.bootstrap)
#sink("/Users/sn0wfree/Dropbox/PhD_1st_study/BST215_Quantitative_Research_Methods_Term_1/QRM_assignment/result/t.bootstrap.txt")
t.test(Northeast.SR.bootstrap,West.SR.bootstrap)
t.test(Northeast.SR.bootstrap,South.SR.bootstrap)
t.test(Northeast.SR.bootstrap,Midwest.SR.bootstrap)
t.test(West.SR.bootstrap,Midwest.SR.bootstrap)
t.test(West.SR.bootstrap,South.SR.bootstrap)
t.test(Midwest.SR.bootstrap,South.SR.bootstrap)
#sink()
hist(West.SR.bootstrap)









#count of project
Northeast.CP.bootstrap=bootstrapfunctiontest(crowdfunding$count_of_Grand.Total[crowdfunding$Region=="Northeast"],1000)
West.CP.bootstrap=bootstrapfunctiontest(crowdfunding$count_of_Grand.Total[crowdfunding$Region=="West"],1000)
Midwest.CP.bootstrap=bootstrapfunctiontest(crowdfunding$count_of_Grand.Total[crowdfunding$Region=="Midwest"],1000)
South.CP.bootstrap=bootstrapfunctiontest(crowdfunding$count_of_Grand.Total[crowdfunding$Region=="South"],1000)
t.test(Northeast.CP.bootstrap,West.CP.bootstrap)
t.test(Northeast.CP.bootstrap,South.CP.bootstrap)
t.test(Northeast.CP.bootstrap,Midwest.CP.bootstrap)
t.test(West.CP.bootstrap,Midwest.CP.bootstrap)
t.test(West.CP.bootstrap,South.CP.bootstrap)
t.test(Midwest.CP.bootstrap,South.CP.bootstrap)
```




### Geography information-wilcox.test
```{r Geography information-wilcox.test}
wilcox.test(crowdfunding$successful_rate[crowdfunding$Region=="West"],crowdfunding$successful_rate[crowdfunding$Region=="Northeast"])
wilcox.test(crowdfunding$successful_rate[crowdfunding$Region=="Midwest"],crowdfunding$successful_rate[crowdfunding$Region=="Northeast"])
wilcox.test(crowdfunding$successful_rate[crowdfunding$Region=="South"],crowdfunding$successful_rate[crowdfunding$Region=="Northeast"])
wilcox.test(crowdfunding$successful_rate[crowdfunding$Region=="West"],crowdfunding$successful_rate[crowdfunding$Region=="Midwest"])


#wilcox.test(crowdfunding$count_of_Grand.Total[crowdfunding$Region=="West"],crowdfunding$count_of_Grand.Total[crowdfunding$Region=="Northeast"])


#calcualte P Value in the wilcox.test of Successful Rate by Region 

p=NULL
temp<-NULL
for (location1 in c(levels(crowdfunding$Region))){
  for (location2 in c(levels(crowdfunding$Region))){
    if (1){
      temp<-wilcox.test(crowdfunding$successful_rate[crowdfunding$Region==location1],crowdfunding$successful_rate[crowdfunding$Region==location2])
      if(temp$p.value<=0.1){
        #print(c(location1,location2,temp$p.value))
      }
      p<-c(p,temp$p.value)}}}
SR.wilcox.test.p.vlaue<-as.data.frame(matrix(p,4,4),row.names = c(levels(crowdfunding$Region)))
colnames(SR.wilcox.test.p.vlaue)<-c(levels(crowdfunding$Region))
print("Successful Rate by Region")
SR.wilcox.test.p.vlaue
#--------------------------------------------------------
#calcualte P Value in the t.test of Count of projects by Region 

p=NULL
temp<-NULL
for (location1 in c(levels(crowdfunding$Region))){
  for (location2 in c(levels(crowdfunding$Region))){
    if (1){
      temp<-wilcox.test(log(crowdfunding$count_of_Grand.Total[crowdfunding$Region==location1]),log(crowdfunding$count_of_Grand.Total[crowdfunding$Region==location2]))
      if(temp$p.value<=0.1){
        #print(c(location1,location2,temp$p.value))
      }
      p<-c(p,temp$p.value)}}}
CP.wilcox.test.p.vlaue<-as.data.frame(matrix(p,4,4),row.names = c(levels(crowdfunding$Region)))
colnames(CP.wilcox.test.p.vlaue)<-c(levels(crowdfunding$Region))
print("Count of Projects by Region ")
CP.wilcox.test.p.vlaue
#--------------------------------------------------------
#calcualte P Value in the t.test of Count of projects by kmeans 
"MDS-Category"
p=NULL

temp<-NULL
#for (location1 in 1:4){
#  for (location2 in 1:4){
#    if (1){
#      temp<-wilcox.test(crowdfunding$successful_rate[crowdfunding$MDS_Category==location1],crowdfunding$successful_rate[crowdfunding$MDS_Category==location2])
#      if(temp$p.value<=0.1){
#        print(c(location1,location2,temp$p.value))
#      }
#      p<-c(p,temp$p.value)}}}
#MDSR.wilcox.test.p.vlaue<-as.data.frame(matrix(p,4,4),row.names = c(1:4))
#colnames(MDSR.wilcox.test.p.vlaue)<-c(1:4)
#print("Successful Rate by Region")
#MDSR.wilcox.test.p.vlaue
```



## Factors analysis
This article is to analyse the factors to the crowdfunding successful rate.
I guess the Education, the inequity of family income and the poverty rate may be related to the crowdfunding successful rate. and in the follow context, i will analyse the those factors.

Firstly, The Statistical Summary
### Factors Analysis-Statistical Summary
```{r Factors Analysis-Statistical Summary}
library(moments)

summary(crowdfunding$successful_rate)
kurtosis(crowdfunding$successful_rate)

summary(crowdfunding$GiniCoeff)
kurtosis(crowdfunding$GiniCoeff)

summary(crowdfunding$pAdDeg)
kurtosis(crowdfunding$pAdDeg)

summary(crowdfunding$PovRate1)
kurtosis(crowdfunding$PovRate1)

```

### Factors Analysis-Plot for Factors
```{r Plot for Factors}

boxplot(crowdfunding$successful_rate,crowdfunding$GiniCoeff,crowdfunding$pAdDeg,crowdfunding$PovRate1,names = c("Successful Rate","GiniCoeff","Higher Education","PovRate1"),main="Factors Box Plot")

par(mfrow=c(1,4))
plot(crowdfunding$successful_rate,col=crowdfunding$Region,pch=10,cex=1.5,xlab="State",ylab="Successful Rate",xaxt="n",main="Successful Rate Plot with lowess line")
points(lowess(crowdfunding$successful),type="l")
legend("topleft",legend = levels(crowdfunding$Region),cex = 0.8, pch = 1,col=1:4)

plot(crowdfunding$GiniCoeff,col=crowdfunding$Region,pch=18,cex=1.5,xlab="State",xaxt="n",ylab="GiniCoeff ",xaxt="n",main="GiniCoeff Plot with lowess line")
points(lowess(crowdfunding$GiniCoeff),type="l")
legend("topleft",legend = levels(crowdfunding$Region),cex = 0.8, pch = 1,col=1:4)

plot(crowdfunding$pAdDeg,col=crowdfunding$Region,pch=15,cex=1.5,xlab="State",xaxt="n",ylab="Adanced Education Rate",xaxt="n",main="Adanced Education Rate Plot with lowess line")
points(lowess(crowdfunding$pAdDeg),type="l")
legend("topright",legend = levels(crowdfunding$Region),cex = 0.8, pch = 1,col=1:4)

plot(crowdfunding$pAdDeg,col=crowdfunding$Region,pch=15,cex=1.5,xlab="State",xaxt="n",ylab="Adanced Education Rate",xaxt="n",main="Adanced Education Rate Plot with lowess line")
points(lowess(crowdfunding$pAdDeg),type="l")
legend("topright",legend = levels(crowdfunding$Region),cex = 0.8, pch = 1,col=1:4)

require(car)
scatterplotMatrix(~successful_rate+PovRate1+pAdDeg,data=crowdfunding,spread=1,upper.panel=NULL,main="Scatter Plot Matrix on Factors")

require(moments)
kurtosis(crowdfunding$pAdDeg)
#plot(crowdfunding$PovRate1,col="black",pch=16,xlab="State",xaxt="n",ylab="Poverty Rate",xaxt="n",main="Poverty Rate Plot")
#library(gridExtra)

summary(lm(log(successful_rate)~log(Collectivism),data=crowdfunding))
ggplot(crowdfunding,aes(y=successful_rate,x=Collectivism))+geom_point()+geom_smooth(method="lm")

```





```{r scatterplot}
library(car)
scatterplot(crowdfunding$successful_rate,log(crowdfunding$average_of_goal_Grand.Total),pch=19)
scatterplot(crowdfunding$successful_rate~crowdfunding$GiniCoeff,pch=19)
scatterplot(crowdfunding$successful_rate~crowdfunding$PovRate1,pch=19)
scatterplot(crowdfunding$successful_rate~crowdfunding$Densitym2,pch=19)
scatterplot(crowdfunding$successful_rate~crowdfunding$pHigh,pch=19)
scatterplot(crowdfunding$successful_rate~crowdfunding$pBatDeg,pch=19)
scatterplot(crowdfunding$successful_rate~crowdfunding$pAdDeg,pch=19)


```


### Factors Analysis-Successful Rate|PovRate1
```{r Successful Rate-PovRate1}
#redo scatterplot with Successful Rate-PovRate1
scatterplot(crowdfunding$successful_rate,crowdfunding$PovRate1,pch=19)

#anova(successful_rate2PovRate1)
library(ggplot2)
ggplot(crowdfunding,aes(x=PovRate1,y=successful_rate,main = "Successful rate~PovRate"))+geom_point(aes(col=Region))+geom_smooth(method = "loess")+ggtitle("Successful Rate-PovRate1 Plot")+theme(plot.title=element_text(hjust=0.5))

par(mfrow=c(1,2))

boxplot(crowdfunding$successful_rate,crowdfunding$PovRate1,names=c("Successful Rate","PovRate1"))
boxplot(crowdfunding$successful_rate[crowdfunding$PovRate1>mean(crowdfunding$PovRate1)],crowdfunding$successful_rate[crowdfunding$PovRate1<=mean(crowdfunding$PovRate1)],col = c("green","deepskyblue"),names=c("Successful%(High PovRate)","Successful%(Low PovRate)"),xlab="Successful rate by PovRate1")



t.test(crowdfunding$successful_rate[crowdfunding$PovRate1>mean(crowdfunding$PovRate1)],crowdfunding$successful_rate[crowdfunding$PovRate1<=mean(crowdfunding$PovRate1)])



plot(crowdfunding$PovRate1,crowdfunding$successful_rate,pch=19,col=crowdfunding$Region,ylab="Successful Rate",xlab="PovRate1",main="Successful Rate-PovRate1 Plot with lowess line")
points(lowess(crowdfunding$PovRate1,crowdfunding$successful_rate,f=1/3),pch=4,col="orange",type="l")
#abline(lm(crowdfunding$successful_rate~crowdfunding$PovRate1),col="orange")
legend("bottomright",legend = levels(crowdfunding$Region),cex = 0.8, pch = 19,col=1:4)


qqplot(crowdfunding$PovRate1,crowdfunding$successful_rate,pch=1,col=crowdfunding$Region,main="QQ plot: (Successful Rate & PovRate)")
qqline(crowdfunding$PovRate1 ,crowdfunding$successful_rate,col="red")
legend("topleft",legend = levels(crowdfunding$Region), pch = 19,col=1:3)




par(mfrow=c(1,1))
#qqnorm(crowdfunding$successful_rate,col=crowdfunding$Region,xlab="Successful Rate")
#qqline(crowdfunding$successful_rate,col="red")
qqnorm(crowdfunding$PovRate1,col=crowdfunding$Region,pch=18,xlab ="PovRate1")
qqline(crowdfunding$PovRate1,col="red")
```

```{r successful_rate-PovRate1:ggplot}
require(ggplot2)
ggplot(crowdfunding,aes(x=PovRate1,y=successful_rate,main = "Successful rate~PovRate1"))+geom_point(aes(group=1,col=Region))+geom_smooth(method = "loess",se=FALSE,aes(group=2,col="Loess Line"),lty="dashed")+geom_smooth(method = "lm",aes(group=2,col="Regression Line"),cex=0.8,lty=1)+ggtitle("Successful Rate-PovRate1 Plot with Loess line and OLS-estimated line")+labs(x="PovRate1",y="Successful Rate")+theme(plot.title=element_text(hjust=0.5))+scale_colour_manual(values = c("purple", "magenta", "orange","red", "blue", "green3" ),guide = guide_legend(title="Legend",override.aes = list(linetype = c( "dashed",rep("blank", 2), "solid",rep("blank", 2)),shape = c(NA,rep(16, 2), NA,rep(16, 2) ))))



```



```{r reset-Chow test}
require(lmtest)
require(strucchange)
resettest(crowdfunding$successful_rate~crowdfunding$GiniCoeff+(crowdfunding$GiniCoeff)^2)

sctest(log(crowdfunding$successful_rate)~log(crowdfunding$GiniCoeff),type="Chow")

resettest(log(crowdfunding$successful_rate)~log(crowdfunding$pAdDeg))

sctest(crowdfunding$successful_rate~crowdfunding$pAdDeg,type="Chow",point=0.12)
plot(crowdfunding$successful_rate~crowdfunding$pAdDeg)
points(lowess(crowdfunding$successful_rate~crowdfunding$pAdDeg),type="l")
```

```{r testfornothing}
b=NA
for (i in 150:170){
a<-sctest(log(crowdfunding$successful_rate)~log(crowdfunding$pAdDeg),type="Chow",point=i/1000)
b[i]=a$p.value
#if (a$p.value<=0.05){print (i/100)}
}
plot(b,type="l")
b[9]
sctest(log(crowdfunding$successful_rate)~log(crowdfunding$pAdDeg),type="Chow",point=0.17)
```

### Factors Analysis-Successful Rate|GiniCoeff
```{r Successful Rate-GiniCoeff}

ggplot(crowdfunding,aes(x=GiniCoeff,y=successful_rate,main = "Successful rate~GiniCoeff"))+geom_point(group=1,aes(col=Region))+geom_smooth(method = "loess",se=FALSE,lty="dashed",aes(group=2,col="Trendline"))+geom_smooth(method = "lm",aes(group=2,col="Regression"),lty=1,cex=0.5)+ggtitle("Successful Rate-GiniCoeff Plot with loess line and OLS-estimated line")+labs(x="GiniCoeff",y="Successful Rate")+theme(plot.title=element_text(hjust=0.5))


anova(successful_rate2GiniCoeff)


t.test(crowdfunding$successful_rate[crowdfunding$GiniCoeff>mean(crowdfunding$GiniCoeff)],crowdfunding$successful_rate[crowdfunding$GiniCoeff<=mean(crowdfunding$GiniCoeff)])

par(mfrow=c(1,2))


boxplot(crowdfunding$successful_rate,crowdfunding$GiniCoeff,names=c("Successful Rate","GiniCoeff"))
boxplot(crowdfunding$successful_rate[crowdfunding$GiniCoeff>mean(crowdfunding$GiniCoeff)],crowdfunding$successful_rate[crowdfunding$GiniCoeff<=mean(crowdfunding$GiniCoeff)],col = c("darkorchid2","dodgerblue"),names=c("Successful%(High GiniCoeff)","Successful%(Low GiniCoeff)"),xlab="Successful rate by GiniCoeff")







plot(crowdfunding$successful_rate,crowdfunding$GiniCoeff,f=1/3 ,pch=19,col="blue",xlab="Successful Rate",ylab="GiniCoeff",main="Successful Rate-GiniCoeff Plot with lowess line")
points(lowess(crowdfunding$successful_rate,crowdfunding$GiniCoeff,f=1/3),pch=4,col="red",type="l")


qqplot(crowdfunding$GiniCoeff,crowdfunding$successful_rate,pch=18,main="Q-Q Plot: Successful Rate-GiniCoeff with lowess line",xlab="Gini Coefficient",ylab="Successful Rate")
points(lowess(crowdfunding$GiniCoeff,crowdfunding$successful_rate),type="l",col="red")

#qqline(crowdfunding$successful_rate,crowdfunding$GiniCoeff)


#qqnorm(crowdfunding$successful_rate,col="orange",xlab="Successful Rate")
#qqline(crowdfunding$successful_rate,col="red")
par(mfrow=c(1,1))
qqnorm(crowdfunding$GiniCoeff,col="blue",pch=20,xlab="GiniCoeff")
qqline(crowdfunding$GiniCoeff,col="red")


summary(lm(crowdfunding$successful_rate~crowdfunding$GiniCoeff))

```


```{r successful_rate-GiniCoeff:ggplot}

ggplot(crowdfunding,aes(x=GiniCoeff,y=successful_rate,main = "Successful rate~GiniCoeff"))+geom_point(aes(group=1,col=Region))+geom_smooth(method = "loess",se=FALSE,aes(group=2,col="Loess Line"),lty="dashed")+geom_smooth(method = "lm",aes(group=2,col="Regression Line"),cex=0.8,lty=1)+ggtitle("Successful Rate-GiniCoeff Plot with Loess line and OLS-estimated line")+labs(x="GiniCoeff",y="Successful Rate")+theme(plot.title=element_text(hjust=0.5))+scale_colour_manual(values = c("purple", "magenta", "orange","red", "blue", "green3" ),guide = guide_legend(title="Legend",override.aes = list(linetype = c( "dashed",rep("blank", 2), "solid",rep("blank", 2)),shape = c(NA,rep(16, 2), NA,rep(16, 2) ))))



```




### Factors Analysis-Successful Rate|Advanced Education]
 
```{r successful_rate-pAdDeg:ggplot}
ggplot(crowdfunding,aes(x=pAdDeg,y=successful_rate))+geom_point(aes(col=Region))+geom_smooth(method = "loess",se=FALSE,lty=2,aes(col="Loess Line"))+geom_smooth(method = "lm",aes(col="Regression Line"),cex=0.8)+ggtitle("Successful Rate-Adanced Education Plot with Loess line and OLS-estimated line")+labs(x="Advanced Education",y="Successful Rate")+theme(plot.title=element_text(hjust=0.5))+scale_colour_manual(values = c("purple", "magenta","orange", "red", "blue", "green3" ),guide = guide_legend(title="Legend",override.aes = list(linetype = c( "dashed",rep("blank", 2), "solid",rep("blank", 2)),shape = c( NA,rep(16, 2), NA,rep(16, 2)))))
```


```{r Successful Rate-Advanced Education}
ggplot(crowdfunding,aes(x=pAdDeg,y=successful_rate))+geom_point(aes(col=Region))+geom_smooth(method = "loess",se=FALSE,lty=2)+geom_smooth(method = "lm",col="red",cex=0.8)+ggtitle("Successful Rate-Adanced Education Plot")+labs(x="Advanced Education",y="Successful Rate")+theme(plot.title=element_text(hjust=0.5))

plot(lowess(crowdfunding$pAdDeg,crowdfunding$successful_rate))

anova(successful_rate2pAdDeg)

par(mfrow=c(1,2))

boxplot(crowdfunding$successful_rate,crowdfunding$pAdDeg,names=c("Successful rate","Adanced Education"))
boxplot(crowdfunding$successful_rate[crowdfunding$pAdDeg>mean(crowdfunding$pAdDeg)],crowdfunding$successful_rate[crowdfunding$pAdDeg<=mean(crowdfunding$pAdDeg)],col = c("darkorchid2","dodgerblue"),names=c("Successful%(High Adanced Education)","Successful%(Low Adanced Education)"),xlab="Successful rate by Adanced Education")


t.test(crowdfunding$successful_rate[crowdfunding$pAdDeg>mean(crowdfunding$pAdDeg)],crowdfunding$successful_rate[crowdfunding$pAdDeg<=mean(crowdfunding$pAdDeg)])


plot(crowdfunding$successful_rate,crowdfunding$pAdDeg,f=1/3 ,pch=19,col="blue",xlab="Successful Rate",ylab="Adanced Education",main="Successful Rate-Adanced Education Plot with lowess line")
points(lowess(crowdfunding$successful_rate,crowdfunding$pAdDeg,f=1/3),pch=4,col="red",type="l")


qqplot(crowdfunding$successful_rate,crowdfunding$pAdDeg,pch=19,col="red",main="Q-Q Plot: Successful Rate-Adanced Education")
qqline(crowdfunding$successful_rate,crowdfunding$pAdDeg)


#qqnorm(crowdfunding$successful_rate,col="orange",xlab="Successful Rate")
#qqline(crowdfunding$successful_rate,col="red")
par(mfrow=c(1,1))
qqnorm(crowdfunding$pAdDeg,col="blue",pch=20,xlab="Adanced Education")
qqline(crowdfunding$pAdDeg,col="red")

summary(lm(crowdfunding$successful_rate~crowdfunding$pAdDeg))

```
### Factors Analysis- Ginicoeff|Advanced Education

```{r Ginicoeff|Advanced Education}
require(ggplot2)
ggplot(crowdfunding,aes(x=pAdDeg,y=GiniCoeff))+geom_point(aes(col=Region))+geom_smooth(method = "loess",se=FALSE,lty=2)+geom_smooth(method = "lm",col="red",cex=0.8)+ggtitle("Successful Rate-Adanced Education Plot")+labs(x="Advanced Education",y="GiniCoeff")+theme(plot.title=element_text(hjust=0.5))

plot(lowess(crowdfunding$pAdDeg,crowdfunding$GiniCoeff))



par(mfrow=c(1,2))

boxplot(crowdfunding$GiniCoeff,crowdfunding$pAdDeg,names=c("Successful rate","Adanced Education"))
boxplot(crowdfunding$GiniCoeff[crowdfunding$pAdDeg>mean(crowdfunding$pAdDeg)],crowdfunding$GiniCoeff[crowdfunding$pAdDeg<=mean(crowdfunding$pAdDeg)],col = c("darkorchid2","dodgerblue"),names=c("GiniCoeff(High Adanced Education)","GiniCoeff(Low Adanced Education)"),xlab="GiniCoeff by Adanced Education")


t.test(crowdfunding$GiniCoeff[crowdfunding$pAdDeg>mean(crowdfunding$pAdDeg)],crowdfunding$GiniCoeff[crowdfunding$pAdDeg<=mean(crowdfunding$pAdDeg)])


plot(crowdfunding$GiniCoeff,crowdfunding$pAdDeg,f=1/3 ,pch=19,col="blue",xlab="Successful Rate",ylab="Adanced Education",main="GiniCoeff-Adanced Education Plot with lowess line")
points(lowess(crowdfunding$GiniCoeff,crowdfunding$pAdDeg,f=1/3),pch=4,col="red",type="l")


qqplot(crowdfunding$GiniCoeff,crowdfunding$pAdDeg,pch=19,col="red",main="Q-Q Plot: GiniCoeff-Adanced Education")
qqline(crowdfunding$GiniCoeff,crowdfunding$pAdDeg)


#qqnorm(crowdfunding$GiniCoeff,col="orange",xlab="GiniCoeff")
#qqline(crowdfunding$GiniCoeff,col="red")
par(mfrow=c(1,1))
qqnorm(crowdfunding$pAdDeg,col="blue",pch=20,xlab="Adanced Education")
qqline(crowdfunding$pAdDeg,col="red")



```


```{r}

require(corpcor)
require(ggm)


xcor=cor(se)#相关系数矩阵 
xpcor=cor2pcor(xcor)#偏相关矩阵
xpcor
xcor
require(psych)
u<-colnames(xcor)
u


pcortest_dev<-function(x_set,y,dataset){
  require(psych)
  require(ggm)
  for (nv in length(x_set) ){
    
    data_subset<-dataset
    data_subset[x_set[nv]]<-NULL
    x_subset=x_set
    x_subset=x_subset[-nv]
    jsbl <- c(x_subset,y)   #要计算的相关系数的变量下标
    tjbl <- c(x_set[nv])  #条件(控制)变量的下标，即要排除影响的变量的下标
    r<-pcor(c(jsbl,tjbl),cor(dataset))
    q <- length(tjbl) 
    n <- dim(dataset)[1]
    print(x_set[nv])
    pcor_test<- pcor.test(r,q,n)
   
    print(pcor_test)
  }
  return(pcor_test)
}
pcortest_dev(c("GiniCoeff","pAdDeg"),c("successful_rate"),se)

a<-1



a1_temp=lm(crowdfunding$successful_rate~crowdfunding$GiniCoeff)
b1_temp=lm(crowdfunding$pAdDeg~crowdfunding$GiniCoeff)
cor.test(a1_temp$residuals,b1_temp$residuals)

a2_temp=lm(crowdfunding$successful_rate~crowdfunding$pAdDeg)
b2_temp=lm(crowdfunding$GiniCoeff~crowdfunding$pAdDeg)


se_s[1]
jsbl <- c("pAdDeg","successful_rate")   #要计算的相关系数的变量下标
tjbl <- c("GiniCoeff")  #条件(控制)变量的下标，即要排除影响的变量的下标
jsbl <- c("GiniCoeff","successful_rate")   #要计算的相关系数的变量下标
tjbl <- c("pAdDeg")  #条件(控制)变量的下标，即要排除影响的变量的下标
r<-pcor(c(jsbl,tjbl),cor(se))

q <- length(tjbl)   #计算要控制的变量数
n <- dim(se)[1]  #计算样本量

pcor_test.GiniCoeff <- pcor.test(r,q,n) #偏相关系数显著性检验结果（输出序号3）
r.GiniCoeff=r
pcor_test.GiniCoeff

pcor_test.pAdDeg <- pcor.test(r,q,n)
r.pAdDeg=r
pcor_test.pAdDeg
corr.test(se,use="pairwise")

```



```{r regression diagnostic}
summary(lm(crowdfunding$GiniCoeff~crowdfunding$pAdDeg))
cor.test(crowdfunding$GiniCoeff,crowdfunding$pAdDeg)



summary(lm(log(crowdfunding$GiniCoeff)~log(crowdfunding$pAdDeg)))
cor.test(log(crowdfunding$GiniCoeff),log(crowdfunding$pAdDeg))


qqplot(log(crowdfunding$successful_rate),log(crowdfunding$GiniCoeff))
qqplot(log(crowdfunding$successful_rate),log(crowdfunding$pAdDeg))

require(gvlma)
summary(gvlma(lm(log(crowdfunding$successful_rate)~log(crowdfunding$pAdDeg))))
summary(gvlma(lm(crowdfunding$successful_rate~crowdfunding$pAdDeg)))

summary(gvlma(lm(log(crowdfunding$successful_rate)~log(crowdfunding$GiniCoeff))))
summary(gvlma(lm(crowdfunding$successful_rate~crowdfunding$GiniCoeff)))

summary(lm(crowdfunding$successful_rate~crowdfunding$GiniCoeff))

par(mfrow=c(2,2))
plot(lm(log(crowdfunding$successful_rate)~log(crowdfunding$pAdDeg)))
plot(lm(crowdfunding$successful_rate~crowdfunding$pAdDeg))
plot(lm(crowdfunding$successful_rate~crowdfunding$GiniCoeff))

SR2Gini<-lm(crowdfunding$successful_rate~crowdfunding$GiniCoeff)
cor.test(crowdfunding$successful_rate,crowdfunding$GiniCoeff,method = "spearman")
summary(lm(SR2Gini$residuals~crowdfunding$pAdDeg))
cor.test(crowdfunding$successful_rate,crowdfunding$pAdDeg,method = "spearman")

summary(gvlma(lm(SR2Gini$residuals~crowdfunding$pAdDeg)))

SR2ad<-lm(crowdfunding$successful_rate~crowdfunding$pAdDeg)
cor.test(crowdfunding$successful_rate,crowdfunding$pAdDeg)
summary(lm(SR2ad$residuals~crowdfunding$GiniCoeff))
summary(gvlma(lm(SR2ad$residuals~crowdfunding$GiniCoeff)))

summary(gvlma(lm(crowdfunding$successful_rate~crowdfunding$GiniCoeff+crowdfunding$pAdDeg)))
require(car)

#SR2Gini---------
qqPlot(SR2Gini,labels=row.names(crowdfunding),id.method="identify",simulate=TRUE,main="Q-Q Plot")

influencePlot(SR2Gini,labels=row.names(crowdfunding),id.method="identify",main="Influence Plot", sub="Circle size if proportional to Cook's distance")  

#SR2all----------

SR2GiniAdedc<-lm(successful_rate~GiniCoeff+pAdDeg,data=crowdfunding)

qqPlot(SR2GiniAdedc,labels=row.names(crowdfunding),id.method="identify",simulate=TRUE,main="Q-Q Plot")
influencePlot(SR2GiniAdedc,labels=row.names(crowdfunding),id.method="identify",main="Influence Plot", sub="Circle size if proportional to Cook's distance")  
#
anova(SR2GiniAdedc)

summary(gvlma(lm(successful_rate~NPov000s,data=crowdfunding)))


SR2ginieduclevel<-lm(successful_rate~pAdDeg+PovRate1,data=crowdfunding)
summary(gvlma(SR2ginieduclevel))
logSR2ginieduclevel<-lm(log(successful_rate)~log(pAdDeg)+log(PovRate1),data=crowdfunding)
summary(gvlma(logSR2ginieduclevel))

test1<-lm(pAdDeg~PovRate1,data=crowdfunding)
test2<-lm(PovRate1~pAdDeg,data=crowdfunding)


plot(SR2ginieduclevel)
anova(SR2ginieduclevel)



#plot(crowdfunding$education_leverage,crowdfunding$successful_rate)
#boxplot(crowdfunding$successful_rate[crowdfunding$education_leverage==1],crowdfunding$successful_rate[crowdfunding$education_leverage==6])



#vif:Variance Inflation Factor----------
vif(SR2GiniAdedc)
vif(SR2ginieduclevel)


sqrt(vif(SR2GiniAdedc))>2
sqrt(vif(SR2ginieduclevel))>2
#PCA---------

prcomp(~pAdDeg+PovRate1,data=crowdfunding)


require(moments)
kurtosis(crowdfunding$successful_rate)
skewness(crowdfunding$successful_rate)

summary(gvlma(lm(crowdfunding$successful_rate~test1$residuals)))
summary(gvlma(lm(crowdfunding$successful_rate~test2$residuals)))

```
